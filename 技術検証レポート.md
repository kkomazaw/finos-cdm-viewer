# FINOS CDM Viewer - æŠ€è¡“æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2026-01-15
**æ¤œè¨¼è€…**: Technical Lead
**æ¤œè¨¼ç›®çš„**: Rosettaãƒ‘ãƒ¼ã‚µãƒ¼ã®å®Ÿè£…å¯èƒ½æ€§ã¨ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—é–‹ç™º

---

## 1. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

æœ¬æŠ€è¡“æ¤œè¨¼ã§ã¯ã€FINOS CDMã‚’TypeScript/VS Codeç’°å¢ƒã§è§£æãƒ»è¡¨ç¤ºã™ã‚‹ãŸã‚ã®æŠ€è¡“çš„å®Ÿç¾å¯èƒ½æ€§ã‚’èª¿æŸ»ã—ã¾ã—ãŸã€‚

### ä¸»ãªç™ºè¦‹äº‹é …

1. **æ—¢å­˜ã®VS Codeæ‹¡å¼µæ©Ÿèƒ½ãŒå­˜åœ¨**: REGnosysã®"Rune-DSL VSCode Language Plugin"ãŒå…¬é–‹æ¸ˆã¿ï¼ˆå®Ÿé¨“çš„ï¼‰
2. **Javaãƒ™ãƒ¼ã‚¹ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **: Rosetta/Rune DSLã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã¯ä¸»ã«Java (Eclipse EMF + Xtext + ANTLR)
3. **TypeScriptã§ã®ãƒ‘ãƒ¼ã‚µãƒ¼ä¸åœ¨**: TypeScript/JavaScriptãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯è¦‹ã¤ã‹ã‚‰ãš
4. **CDMã®è¦æ¨¡**: ç´„150ã®Rosettaãƒ•ã‚¡ã‚¤ãƒ«ã€åˆè¨ˆæ•°MBã®ãƒ¢ãƒ‡ãƒ«å®šç¾©

### æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: è»½é‡ç‹¬è‡ªãƒ‘ãƒ¼ã‚µãƒ¼ + æ—¢å­˜VS Codeæ‹¡å¼µæ©Ÿèƒ½ã®æ´»ç”¨**ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

---

## 2. èª¿æŸ»å†…å®¹

### 2.1 æ—¢å­˜ãƒ„ãƒ¼ãƒ«ã®èª¿æŸ»çµæœ

#### 2.1.1 Rune DSL (æ—§ Rosetta DSL)

**ãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/finos/rune-dsl (REGnosysã‹ã‚‰ FINOSã¸ç§»ç®¡æ¸ˆã¿)

**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
- Eclipse Modeling Framework (EMF)
- Xtext (DSLè¨˜è¿°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)
- ANTLR (ãƒ‘ãƒ¼ã‚µãƒ¼ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼)
- Java 17-21

**æ©Ÿèƒ½**:
- Rosetta DSLæ–‡æ³•å®šç¾©
- Javaã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- ãƒ‘ãƒ¼ã‚µãƒ¼ã¨ASTãƒ¢ãƒ‡ãƒ«

#### 2.1.2 Rune-DSL VSCode Extension

**ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹**: https://marketplace.visualstudio.com/items?itemName=nicholas-moger.rune-dsl-language-support

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âš ï¸ EXPERIMENTAL
**ä½œè€…**: ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é–‹ç™ºï¼ˆéå…¬å¼ï¼‰

**æ©Ÿèƒ½**:
- ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
- ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ
- ãƒ›ãƒãƒ¼æƒ…å ±
- Javaã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**æŠ€è¡“å®Ÿè£…**:
- Language Server Protocol (LSP)çµŒç”±ã§Javaãƒ—ãƒ­ã‚»ã‚¹ã¨é€šä¿¡
- Java 11+å¿…é ˆ
- Mavenå¿…é ˆ

**åˆ¶ç´„äº‹é …**:
- Javaãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¸ã®ä¾å­˜
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œï¼ˆå¤§è¦æ¨¡ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
- å®Ÿé¨“çš„å“è³ª

#### 2.1.3 Rosetta Code Generators

**ãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/REGnosys/rosetta-code-generators

**å¯¾å¿œè¨€èª**:
- Java (ãƒ“ãƒ«ãƒˆã‚¤ãƒ³)
- TypeScript
- C#
- Go
- Kotlin
- Scala
- DAML

**ç”¨é€”**: Rosettaãƒ¢ãƒ‡ãƒ«ã‹ã‚‰å„è¨€èªã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ

**é‡è¦ãªç™ºè¦‹**: ã“ã‚Œã¯**ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼**ã§ã‚ã‚Šã€**ãƒ‘ãƒ¼ã‚µãƒ¼**ã§ã¯ãªã„ã€‚CDMã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã«ã¯ã€æ—¢å­˜ã®Rune DSLãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆJavaï¼‰ãŒå¿…è¦ã€‚

### 2.2 FINOS CDMã®æ§‹é€ åˆ†æ

#### 2.2.1 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
rosetta-source/src/main/rosetta/
â”œâ”€â”€ base-*                    # åŸºæœ¬å‹ãƒ»å…±é€šæ©Ÿèƒ½
â”œâ”€â”€ event-*                   # ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©
â”œâ”€â”€ product-*                 # é‡‘èå•†å“å®šç¾©
â”œâ”€â”€ legaldocumentation-*      # æ³•çš„æ–‡æ›¸
â”œâ”€â”€ observable-*              # è¦³æ¸¬å¯èƒ½ãªå€¤
â”œâ”€â”€ margin-*                  # è¨¼æ‹ é‡‘
â”œâ”€â”€ ingest-fpml-*             # FpMLå–ã‚Šè¾¼ã¿
â””â”€â”€ mapping-*                 # ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©
```

**çµ±è¨ˆ**:
- ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°: ç´„150ãƒ•ã‚¡ã‚¤ãƒ«
- å‘½åè¦å‰‡: `<domain>-<subdomain>-<type>.rosetta`
  - `<domain>`: base, event, product, etc.
  - `<subdomain>`: datetime, party, asset, etc.
  - `<type>`: enum, type, func, desc

#### 2.2.2 Rosetta DSLæ§‹æ–‡ã‚µãƒ³ãƒ—ãƒ«

```rosetta
namespace cdm.base.datetime : <"Basic date and time concepts">
version "${project.version}"

import cdm.base.staticdata.codelist.*

type AdjustableDate: <"A class for defining a date...">
    [metadata key]

    unadjustedDate date (0..1) <"A date subject to adjustment.">
    dateAdjustments BusinessDayAdjustments (0..1) <"The business day convention...">
    adjustedDate date (0..1) <"The date once the adjustment has been performed.">
        [metadata id]

    condition AdjustableDateChoice: <"Choice rule...">
        optional choice dateAdjustments, dateAdjustmentsReference
```

**æ§‹æ–‡è¦ç´ **:
1. **namespace**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å®£è¨€
2. **import**: ä¾å­˜é–¢ä¿‚
3. **type**: ã‚¯ãƒ©ã‚¹å®šç¾©
   - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: `name type (cardinality) <"doc">`
   - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: `[metadata key|id|reference]`
4. **enum**: åˆ—æŒ™å‹
5. **func**: é–¢æ•°å®šç¾©
6. **condition**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
7. **extends**: ç¶™æ‰¿

**ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£è¨˜æ³•**:
- `(0..1)`: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«
- `(1..1)`: å¿…é ˆ
- `(0..*)`: 0å€‹ä»¥ä¸Š
- `(1..*)`: 1å€‹ä»¥ä¸Š

---

## 3. å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®è©•ä¾¡

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: æ—¢å­˜Rune DSL Extensionæ´»ç”¨

#### æ¦‚è¦
æ—¢å­˜ã®Rune-DSL VS Codeæ‹¡å¼µæ©Ÿèƒ½ã‚’åŸºç›¤ã¨ã—ã¦ã€è¿½åŠ æ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… ãƒ‘ãƒ¼ã‚µãƒ¼ãŒæ—¢ã«å­˜åœ¨ï¼ˆJava/ANTLRï¼‰
- âœ… ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆç­‰ã®åŸºæœ¬æ©Ÿèƒ½ã¯åˆ©ç”¨å¯èƒ½
- âœ… å…¬å¼ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã¨ã®äº’æ›æ€§

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ Javaãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¸ã®ä¾å­˜ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒã« Java + Mavenå¿…è¦ï¼‰
- âŒ LSPé€šä¿¡ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
- âŒ å®Ÿé¨“çš„å“è³ªã§ä¸å®‰å®š
- âŒ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå›°é›£ï¼ˆJava/Xtextã®çŸ¥è­˜å¿…è¦ï¼‰
- âŒ TypeScriptã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆãŒè¤‡é›‘

#### å®Ÿè£…é›£æ˜“åº¦
ğŸŸ¡ **ä¸­ã€œé«˜** - Java/Eclipse EMF/Xtextã®å­¦ç¿’ã‚³ã‚¹ãƒˆ

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: è»½é‡ç‹¬è‡ªãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£… âœ… æ¨å¥¨

#### æ¦‚è¦
TypeScriptã§ã€ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã«å¿…è¦ãªæƒ…å ±ã ã‘ã‚’æŠ½å‡ºã™ã‚‹è»½é‡ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’å®Ÿè£…ã€‚

#### å®Ÿè£…æˆ¦ç•¥

**Phase 1: æ­£è¦è¡¨ç¾ãƒ™ãƒ¼ã‚¹ç°¡æ˜“ãƒ‘ãƒ¼ã‚µãƒ¼**
```typescript
interface RosettaType {
  name: string;
  namespace: string;
  doc?: string;
  fields: RosettaField[];
  extends?: string;
  metadata?: string[];
}

interface RosettaField {
  name: string;
  type: string;
  cardinality: string;
  doc?: string;
  metadata?: string[];
}

class SimpleRosettaParser {
  parseFile(content: string): RosettaFile {
    // æ­£è¦è¡¨ç¾ã§ä¸»è¦è¦ç´ ã‚’æŠ½å‡º
    const namespace = this.extractNamespace(content);
    const imports = this.extractImports(content);
    const types = this.extractTypes(content);
    const enums = this.extractEnums(content);
    return { namespace, imports, types, enums };
  }

  private extractTypes(content: string): RosettaType[] {
    const typeRegex = /type\s+(\w+)(?:\s+extends\s+(\w+))?\s*:\s*<"([^"]*)">/g;
    // ... implementation
  }
}
```

**Phase 2: ã‚ˆã‚Šå …ç‰¢ãªãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**
- PEG.js / Nearley.js ã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼ç”Ÿæˆ
- Rosettaæ–‡æ³•ã‚’BNFã§å®šç¾©

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… ã‚¼ãƒ­å¤–éƒ¨ä¾å­˜ï¼ˆJavaãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä¸è¦ï¼‰
- âœ… è»½é‡ãƒ»é«˜é€Ÿ
- âœ… VS Codeãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆ
- âœ… TypeScriptã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹
- âœ… å¿…è¦ãªæƒ…å ±ã ã‘ã‚’æŠ½å‡ºï¼ˆãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ï¼‰
- âœ… æ®µéšçš„æ”¹å–„ãŒå¯èƒ½

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âš ï¸ åˆæœŸé–‹ç™ºã‚³ã‚¹ãƒˆãŒå¿…è¦
- âš ï¸ Rosettaæ§‹æ–‡ã®å®Œå…¨ã‚µãƒãƒ¼ãƒˆã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‹
- âš ï¸ å…¬å¼ãƒ‘ãƒ¼ã‚µãƒ¼ã¨å‹•ä½œãŒç•°ãªã‚‹å¯èƒ½æ€§

#### å®Ÿè£…é›£æ˜“åº¦
ğŸŸ¢ **ä½ã€œä¸­** - TypeScriptæ­£è¦è¡¨ç¾ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã€æ®µéšçš„æ”¹å–„

---

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3: GitHub API + äº‹å‰å‡¦ç†

#### æ¦‚è¦
ãƒ“ãƒ«ãƒ‰æ™‚ã«GitHub APIã§CDMã‚’å–å¾—ã—ã€JSONå½¢å¼ã«å¤‰æ›ã—ã¦é…å¸ƒã€‚

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ãƒ¼ã‚¹ä¸è¦
- âœ… é«˜é€Ÿèµ·å‹•
- âœ… ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…ãŒç°¡ç´ åŒ–

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ã«éå¯¾å¿œ
- âŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãªã—
- âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸å¯

#### å®Ÿè£…é›£æ˜“åº¦
ğŸŸ¢ **ä½** - ã—ã‹ã—æ©Ÿèƒ½ãŒé™å®šçš„

---

## 4. æ¨å¥¨å®Ÿè£…è¨ˆç”»

### 4.1 æ¡ç”¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: è»½é‡ç‹¬è‡ªãƒ‘ãƒ¼ã‚µãƒ¼ + æ®µéšçš„æ©Ÿèƒ½è¿½åŠ **

ç†ç”±:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒã¸ã®ä¾å­˜ãŒæœ€å°ï¼ˆNode.js/VS Codeã®ã¿ï¼‰
2. TypeScriptã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªçµ±åˆ
3. æŸ”è»Ÿãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½
4. æ®µéšçš„ãªå“è³ªå‘ä¸ŠãŒå¯èƒ½

### 4.2 å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

#### MVP (Minimum Viable Product) - 2é€±é–“

**ç›®æ¨™**: åŸºæœ¬çš„ãªå‹å®šç¾©ã®è¡¨ç¤º

**æ©Ÿèƒ½**:
- [ ] æ­£è¦è¡¨ç¾ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
  - namespace, importæŠ½å‡º
  - typeå®šç¾©æŠ½å‡ºï¼ˆåå‰ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
  - enumå®šç¾©æŠ½å‡º
- [ ] ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼å®Ÿè£…
  - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸éšå±¤è¡¨ç¤º
  - å‹ä¸€è¦§è¡¨ç¤º
- [ ] åŸºæœ¬çš„ãªå‹æƒ…å ±è¡¨ç¤º
  - ãƒ›ãƒãƒ¼ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
  - Go to Definitionï¼ˆåŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«å†…ï¼‰

**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
```json
{
  "devDependencies": {
    "@types/vscode": "^1.85.0",
    "@types/node": "^18.x",
    "typescript": "^5.0.0",
    "esbuild": "^0.19.0"
  }
}
```

#### Phase 2 - 4é€±é–“

**ç›®æ¨™**: é–¢ä¿‚æ€§ã®å¯è¦–åŒ–

**è¿½åŠ æ©Ÿèƒ½**:
- [ ] ãƒ‘ãƒ¼ã‚µãƒ¼æ”¹å–„
  - extendsï¼ˆç¶™æ‰¿ï¼‰é–¢ä¿‚ã®æŠ½å‡º
  - å‹å‚ç…§ã®è§£æ±º
  - conditionï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã®æŠ½å‡º
- [ ] ã‚°ãƒ©ãƒ•ãƒ“ãƒ¥ãƒ¼å®Ÿè£…ï¼ˆCytoscape.jsï¼‰
  - ç¶™æ‰¿ãƒ„ãƒªãƒ¼
  - å‹ä¾å­˜ã‚°ãƒ©ãƒ•
- [ ] é«˜åº¦ãªæ¤œç´¢æ©Ÿèƒ½
  - å…¨æ–‡æ¤œç´¢ï¼ˆå‹åã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
  - ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½

#### Phase 3 - 6é€±é–“

**ç›®æ¨™**: é«˜åº¦ãªæ©Ÿèƒ½

**è¿½åŠ æ©Ÿèƒ½**:
- [ ] Find All References
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆJSON/HTMLï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  - ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ‘ãƒ¼ã‚¹
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

### 4.3 ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…è©³ç´°

#### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
src/
â”œâ”€â”€ parser/
â”‚   â”œâ”€â”€ SimpleRosettaParser.ts     # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”œâ”€â”€ RosettaLexer.ts            # ãƒˆãƒ¼ã‚¯ãƒ³åŒ–
â”‚   â”œâ”€â”€ RosettaAst.ts              # ASTå‹å®šç¾©
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ parser.test.ts
â”œâ”€â”€ indexer/
â”‚   â”œâ”€â”€ SymbolIndexer.ts           # ã‚·ãƒ³ãƒœãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
â”‚   â””â”€â”€ ReferenceResolver.ts      # å‚ç…§è§£æ±º
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ TreeDataProvider.ts
â”‚   â”œâ”€â”€ HoverProvider.ts
â”‚   â””â”€â”€ DefinitionProvider.ts
â””â”€â”€ extension.ts
```

#### æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆåˆæœŸç‰ˆï¼‰

```typescript
const PATTERNS = {
  namespace: /^namespace\s+([\w.]+)\s*:\s*<"([^"]*)">?/m,
  import: /^import\s+([\w.*]+)/gm,
  type: /type\s+(\w+)(?:\s+extends\s+(\w+))?\s*:\s*<"([^"]*)">/g,
  field: /(\w+)\s+([\w<>]+)\s+\((\d+\.\.\d+|\d+\.\.\*)\)(?:\s*<"([^"]*)")?/g,
  enum: /enum\s+(\w+)\s*:\s*<"([^"]*)">/g,
  enumValue: /(\w+)\s+displayName\s+"([^"]*)"/g,
  metadata: /\[metadata\s+(key|id|reference|scheme)\]/g,
  condition: /condition\s+(\w+)\s*:\s*<"([^"]*)">([^}]+)/gs
};
```

### 4.4 ä»£æ›¿æ¡ˆ: PEG.jsã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼

ã‚ˆã‚Šå …ç‰¢æ€§ãŒå¿…è¦ãªå ´åˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³:

```peg
// rosetta.pegjs
start = File

File = namespace:Namespace imports:Import* elements:Element*
{
  return { namespace, imports, elements };
}

Namespace = "namespace" _ name:QualifiedName _ ":" _ doc:String
{
  return { name, doc };
}

Type = "type" _ name:Identifier extends:Extends? _ ":" _ doc:String _ fields:Field*
{
  return { kind: 'type', name, extends, doc, fields };
}

Field = name:Identifier _ type:TypeRef _ cardinality:Cardinality doc:String?
{
  return { name, type, cardinality, doc };
}

// ... more rules
```

**ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰**:
```bash
npx pegjs rosetta.pegjs -o src/parser/RosettaParser.ts
```

---

## 5. ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å®Ÿè£…

### 5.1 ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ä»•æ§˜

æœ€å°é™ã®æ©Ÿèƒ½ã‚’æŒã¤ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’å®Ÿè£…ã—ã¦ã€æŠ€è¡“çš„å®Ÿç¾å¯èƒ½æ€§ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

**å®Ÿè£…å†…å®¹**:
1. å˜ä¸€Rosettaãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹
2. å‹å®šç¾©ã®æŠ½å‡ºï¼ˆåå‰ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
3. VS Codeãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ã®è¡¨ç¤º

**æ¤œè¨¼é …ç›®**:
- [ ] ãƒ‘ãƒ¼ã‚¹é€Ÿåº¦ï¼ˆ150ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†æ™‚é–“ï¼‰
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- [ ] VS Codeçµ±åˆã®å®Ÿç¾å¯èƒ½æ€§

### 5.2 ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚³ãƒ¼ãƒ‰ï¼ˆæ¦‚è¦ï¼‰

```typescript
// src/parser/SimpleRosettaParser.ts
export class SimpleRosettaParser {
  parseFile(filePath: string): RosettaFile {
    const content = fs.readFileSync(filePath, 'utf-8');

    return {
      namespace: this.extractNamespace(content),
      types: this.extractTypes(content),
      enums: this.extractEnums(content)
    };
  }

  private extractTypes(content: string): RosettaType[] {
    const types: RosettaType[] = [];
    const typeRegex = /type\s+(\w+)(?:\s+extends\s+(\w+))?\s*:\s*<"([^"]*)">(.*?)(?=\n(?:type|enum|func|$))/gs;

    let match;
    while ((match = typeRegex.exec(content)) !== null) {
      const [, name, extendsName, doc, body] = match;
      types.push({
        name,
        extends: extendsName,
        doc,
        fields: this.extractFields(body)
      });
    }

    return types;
  }

  private extractFields(body: string): RosettaField[] {
    const fields: RosettaField[] = [];
    const fieldRegex = /^\s*(\w+)\s+([\w<>]+)\s+\(([^)]+)\)(?:\s*<"([^"]*)")?/gm;

    let match;
    while ((match = fieldRegex.exec(body)) !== null) {
      const [, name, type, cardinality, doc] = match;
      fields.push({ name, type, cardinality, doc });
    }

    return fields;
  }
}

// src/providers/TreeDataProvider.ts
export class RosettaTreeDataProvider implements vscode.TreeDataProvider<TreeItem> {
  constructor(private parser: SimpleRosettaParser) {}

  getTreeItem(element: TreeItem): vscode.TreeItem {
    return element;
  }

  getChildren(element?: TreeItem): TreeItem[] {
    if (!element) {
      // ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§
      return this.getRootPackages();
    } else if (element.contextValue === 'package') {
      // ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é…ä¸‹ã®å‹ä¸€è¦§
      return this.getTypesInPackage(element.label as string);
    }
    return [];
  }
}
```

---

## 6. ãƒªã‚¹ã‚¯è©•ä¾¡

### 6.1 æŠ€è¡“ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | å¯¾ç­– |
|--------|--------|----------|------|
| ç°¡æ˜“ãƒ‘ãƒ¼ã‚µãƒ¼ã§Rosettaæ§‹æ–‡ã‚’å®Œå…¨ã«ã‚«ãƒãƒ¼ã§ããªã„ | é«˜ | ä¸­ | æ®µéšçš„æ”¹å–„ã€PEG.jsã¸ã®ç§»è¡Œãƒ‘ã‚¹ã‚’ç¢ºä¿ |
| ãƒ‘ãƒ¼ã‚¹é€Ÿåº¦ãŒè¦ä»¶ã‚’æº€ãŸã•ãªã„ | ä¸­ | ä½ | Worker Threadsã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ‘ãƒ¼ã‚¹ |
| ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ãŒå¤§ãã„ | ä¸­ | ä½ | å¿…è¦ãªæƒ…å ±ã ã‘ã‚’ä¿æŒã€Lazy Loading |
| VS Code APIã®åˆ¶ç´„ | ä½ | ä½ | äº‹å‰èª¿æŸ»ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§æ¤œè¨¼æ¸ˆã¿ |

### 6.2 ã‚¹ã‚³ãƒ¼ãƒ—ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | å¯¾ç­– |
|--------|--------|----------|------|
| æ©Ÿèƒ½è¦æ±‚ã®è¿½åŠ ã«ã‚ˆã‚Šé–‹ç™ºãŒé…å»¶ | ä¸­ | ä¸­ | MVPæ©Ÿèƒ½ã‚’æ˜ç¢ºåŒ–ã€å„ªå…ˆåº¦ç®¡ç† |
| Rosetta DSLä»•æ§˜å¤‰æ›´ | ä½ | ä½ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ”ãƒ³ã€æ›´æ–°ç›£è¦– |

---

## 7. æ€§èƒ½è¦‹ç©ã‚‚ã‚Š

### 7.1 ãƒ‘ãƒ¼ã‚¹æ€§èƒ½

**å¯¾è±¡**: FINOS CDMå…¨ä½“ï¼ˆç´„150ãƒ•ã‚¡ã‚¤ãƒ«ã€ç·ã‚µã‚¤ã‚ºç´„3MBï¼‰

**äºˆæ¸¬å€¤** (TypeScriptæ­£è¦è¡¨ç¾ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ¼ã‚µãƒ¼):
- åˆå›ãƒ•ãƒ«ãƒ‘ãƒ¼ã‚¹: **2ã€œ5ç§’**
- ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ‘ãƒ¼ã‚¹ï¼ˆå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰: **50ã€œ100ms**
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: **50ã€œ100MB**

**æ¸¬å®šæ–¹æ³•**: ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§å®Ÿæ¸¬

### 7.2 UIå¿œç­”æ€§

- ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º: **å³åº§**ï¼ˆä»®æƒ³åŒ–ã«ã‚ˆã‚Šï¼‰
- æ¤œç´¢å¿œç­”: **500msä»¥å†…**ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åˆ©ç”¨ï¼‰
- ã‚°ãƒ©ãƒ•æç”»ï¼ˆ50ãƒãƒ¼ãƒ‰ï¼‰: **1ã€œ2ç§’**

---

## 8. çµè«–

### 8.1 æŠ€è¡“çš„å®Ÿç¾å¯èƒ½æ€§

âœ… **å®Ÿç¾å¯èƒ½** - TypeScriptã§ã®è»½é‡ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…ã«ã‚ˆã‚Šã€è¦ä»¶ã‚’æº€ãŸã™ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã®é–‹ç™ºãŒå¯èƒ½ã§ã™ã€‚

### 8.2 æ¨å¥¨å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: è»½é‡ç‹¬è‡ªãƒ‘ãƒ¼ã‚µãƒ¼ + æ®µéšçš„æ©Ÿèƒ½è¿½åŠ **

**ç†ç”±**:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“: Javaä¾å­˜ãªã—ã€è»½é‡ã§é«˜é€Ÿ
2. é–‹ç™ºåŠ¹ç‡: TypeScriptã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ æ´»ç”¨ã€æ®µéšçš„æ”¹å–„
3. æ‹¡å¼µæ€§: ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå®¹æ˜“
4. ä¿å®ˆæ€§: ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 8.3 æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… **å³åº§**: ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å®Ÿè£…é–‹å§‹
   - æ­£è¦è¡¨ç¾ãƒ™ãƒ¼ã‚¹ã®ç°¡æ˜“ãƒ‘ãƒ¼ã‚µãƒ¼
   - å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ãƒ»è¡¨ç¤º

2. **1é€±é–“ä»¥å†…**: æ€§èƒ½æ¸¬å®š
   - FINOS CDMå…¨ä½“ã®ãƒ‘ãƒ¼ã‚¹æ™‚é–“
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

3. **2é€±é–“ä»¥å†…**: MVPå®Œæˆ
   - ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼å®Ÿè£…
   - åŸºæœ¬çš„ãªå‹æƒ…å ±è¡¨ç¤º

---

## 9. ä»˜éŒ²

### 9.1 å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

**å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- Rune DSL Documentation: https://docs.rosetta-technology.io/
- FINOS CDM: https://cdm.finos.org/
- VS Code Extension API: https://code.visualstudio.com/api

**é–¢é€£ãƒªãƒã‚¸ãƒˆãƒª**:
- finos/rune-dsl: https://github.com/finos/rune-dsl
- REGnosys/rosetta-code-generators: https://github.com/REGnosys/rosetta-code-generators
- finos/common-domain-model: https://github.com/finos/common-domain-model

**VS Codeæ‹¡å¼µæ©Ÿèƒ½**:
- Rune-DSL Language Support: https://marketplace.visualstudio.com/items?itemName=nicholas-moger.rune-dsl-language-support

### 9.2 Rosetta DSLæ§‹æ–‡ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

```rosetta
// Namespace declaration
namespace cdm.base.datetime : <"Description">
version "${project.version}"

// Import
import cdm.base.staticdata.codelist.*

// Type definition
type TypeName extends ParentType: <"Description">
    [metadata key]

    fieldName FieldType (0..1) <"Field description">
        [metadata id]
    anotherField AnotherType (1..*) <"Required, one or more">

    condition ConditionName: <"Validation rule">
        fieldName exists

// Enum definition
enum EnumName: <"Description">
    VALUE_1 displayName "Display Name 1"
        <"Value description">
    VALUE_2 displayName "Display Name 2"

// Function definition (çœç•¥)
func FunctionName: <"Description">
    inputs:
        input1 Type1 (1..1)
    output:
        result Type2 (1..1)
```

---

**æ‰¿èª**:

| å½¹å‰² | æ°å | æ‰¿èªæ—¥ | ç½²å |
|------|------|--------|------|
| Technical Lead | | | |
| Project Manager | | | |

**æ”¹è¨‚å±¥æ­´**:

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0 | 2026-01-15 | åˆç‰ˆä½œæˆ | Technical Lead |
